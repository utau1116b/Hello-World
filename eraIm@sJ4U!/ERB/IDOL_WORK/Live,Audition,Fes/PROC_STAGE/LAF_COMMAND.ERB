;LAF_COMMON(PANIMATION.ERB,@FADEを参考)
;ARG:0	行動対象
@PRINT_LIVE_COMMAND_LAF(ARG:0, ARG:2)
#DIM PRICOLOR,1

#DIM RED,2
#DIM GREEN,2
#DIM BLUE,2

#DIM RED2,2
#DIM GREEN2,2
#DIM BLUE2,2

#DIM RED3,2
#DIM GREEN3,2
#DIM BLUE3,2

#DIM RED4,2
#DIM GREEN4,2
#DIM BLUE4,2

#DIM REPEATCOUNT

VARSET LOCAL

VARSET REPEATCOUNT

VARSET RED
VARSET GREEN
VARSET BLUE

VARSET RED2
VARSET GREEN2
VARSET BLUE2

VARSET RED3
VARSET GREEN3
VARSET BLUE3

VARSET RED4
VARSET GREEN4
VARSET BLUE4

;曲によって違ったタイムを
ARG = 6

SETCOLOR GETBGCOLOR()

PRICOLOR = GETBGCOLOR()

;初期色
ARG:2 = SET_COLOR_FUNC("ビジュアル")
;RGBそれぞれのベース値、減少値を各色:0と1に代入
RED = GETRED()
IF RED > GETRED(ARG:2)
	RED:1 = MAX(1, (RED-GETRED(ARG:2))/ARG)
ELSEIF RED < GETRED(ARG:2)
	RED:1 = MIN(-1, (RED-GETRED(ARG:2))/ARG)
ENDIF
GREEN = GETGREEN()
IF GREEN > GETGREEN(ARG:2)
	GREEN:1 = MAX(1, (GREEN-GETGREEN(ARG:2))/ARG)
ELSEIF GREEN < GETGREEN(ARG:2)
	GREEN:1 = MIN(-1, (GREEN-GETGREEN(ARG:2))/ARG)
ENDIF
BLUE = GETBLUE()
IF BLUE > GETBLUE(ARG:2)
	BLUE:1 = MAX(1, (BLUE-GETBLUE(ARG:2))/ARG)
ELSEIF BLUE < GETBLUE(ARG:2)
	BLUE:1 = MIN(-1, (BLUE-GETBLUE(ARG:2))/ARG)
ENDIF

;初期色
ARG:2 = SET_COLOR_FUNC("ダンス")
;RGBそれぞれのベース値、減少値を各色:0と1に代入
RED2 = GETRED()
IF RED2 > GETRED(ARG:2)
	RED2:1 = MAX(1, (RED2-GETRED(ARG:2))/ARG)
ELSEIF RED2 < GETRED(ARG:2)
	RED2:1 = MIN(-1, (RED2-GETRED(ARG:2))/ARG)
ENDIF
GREEN2 = GETGREEN()
IF GREEN2 > GETGREEN(ARG:2)
	GREEN2:1 = MAX(1, (GREEN2-GETGREEN(ARG:2))/ARG)
ELSEIF GREEN2 < GETGREEN(ARG:2)
	GREEN2:1 = MIN(-1, (GREEN2-GETGREEN(ARG:2))/ARG)
ENDIF
BLUE2 = GETBLUE()
IF BLUE2 > GETBLUE(ARG:2)
	BLUE2:1 = MAX(1, (BLUE2-GETBLUE(ARG:2))/ARG)
ELSEIF BLUE2 < GETBLUE(ARG:2)
	BLUE2:1 = MIN(-1, (BLUE2-GETBLUE(ARG:2))/ARG)
ENDIF

;初期色
ARG:2 = SET_COLOR_FUNC("ボーカル")
;RGBそれぞれのベース値、減少値を各色:0と1に代入
RED3 = GETRED()
IF RED3 > GETRED(ARG:2)
	RED3:1 = MAX(1, (RED3-GETRED(ARG:2))/ARG)
ELSEIF RED3 < GETRED(ARG:2)
	RED3:1 = MIN(-1, (RED3-GETRED(ARG:2))/ARG)
ENDIF
GREEN3 = GETGREEN()
IF GREEN3 > GETGREEN(ARG:2)
	GREEN3:1 = MAX(1, (GREEN3-GETGREEN(ARG:2))/ARG)
ELSEIF GREEN3 < GETGREEN(ARG:2)
	GREEN3:1 = MIN(-1, (GREEN3-GETGREEN(ARG:2))/ARG)
ENDIF
BLUE3 = GETBLUE()
IF BLUE3 > GETBLUE(ARG:2)
	BLUE3:1 = MAX(1, (BLUE3-GETBLUE(ARG:2))/ARG)
ELSEIF BLUE3 < GETBLUE(ARG:2)
	BLUE3:1 = MIN(-1, (BLUE3-GETBLUE(ARG:2))/ARG)
ENDIF

;初期色(バースト)
ARG:2 = 0X4bec50
;RGBそれぞれのベース値、減少値を各色:0と1に代入
RED4 = GETRED()
IF RED4 > GETRED(ARG:2)
	RED4:1 = MAX(1, (RED4-GETRED(ARG:2))/ARG)
ELSEIF RED4 < GETRED(ARG:2)
	RED4:1 = MIN(-1, (RED4-GETRED(ARG:2))/ARG)
ENDIF
GREEN4 = GETGREEN()
IF GREEN4 > GETGREEN(ARG:2)
	GREEN4:1 = MAX(1, (GREEN4-GETGREEN(ARG:2))/ARG)
ELSEIF GREEN4 < GETGREEN(ARG:2)
	GREEN4:1 = MIN(-1, (GREEN4-GETGREEN(ARG:2))/ARG)
ENDIF
BLUE4 = GETBLUE()
IF BLUE4 > GETBLUE(ARG:2)
	BLUE4:1 = MAX(1, (BLUE4-GETBLUE(ARG:2))/ARG)
ELSEIF BLUE4 < GETBLUE(ARG:2)
	BLUE4:1 = MIN(-1, (BLUE4-GETBLUE(ARG:2))/ARG)
ENDIF

TSTR = %" "%
REDRAW 0
	$REPEAT_LOOP
	
	;初期色
	ARG:1 = GETBGCOLOR()
	SETCOLOR ARG:1

	CALL SAVELINE
	
	PRINTL 
	
	
	ALIGNMENT CENTER
	
	GETFONT
	CHKFONT "NSimSun"
	SIF RESULT
		SETFONT "NSimSun"

	;色の減算は16進数を割ってマイナスしていく
	IF BASE:0:ボルテージ >= 10000
		RED4 = MAX(0, RED4-RED4:1)
		GREEN4 = MAX(0, GREEN4-GREEN4:1)
		BLUE4 = MAX(0, BLUE4-BLUE4:1)
		SIF RED4 > 255
			RED4 = 255
		SIF GREEN4 > 255
			GREEN4 = 255
		SIF BLUE4 > 255
			BLUE4 = 255
		SETCOLOR RED4, GREEN4, BLUE4
		LOCALS = [ＢＡ]%UNICODE(0x2196)%
		PRINTBUTTON LOCALS, 101
		PRINTFORM 　 
		RESETCOLOR
		;RESETCOLOR
	ELSE
	
	ENDIF
	
	;///////////////
	RED2 = MAX(0, RED2-RED2:1)
	GREEN2 = MAX(0, GREEN2-GREEN2:1)
	BLUE2 = MAX(0, BLUE2-BLUE2:1)
	SIF RED2 > 255
		RED2 = 255
	SIF GREEN2 > 255
		GREEN2 = 255
	SIF BLUE2 > 255
		BLUE2 = 255
	
	SETCOLOR RED2, GREEN2, BLUE2
	PRINTBUTTON "[Ｄａ]←", 9
	PRINTFORM 　
	RESETCOLOR
	
	
	RED = MAX(0, RED-RED:1)
	GREEN = MAX(0, GREEN-GREEN:1)
	BLUE = MAX(0, BLUE-BLUE:1)
	SIF RED > 255
		RED = 255
	SIF GREEN > 255
		GREEN = 255
	SIF BLUE > 255
		BLUE = 255
	SETCOLOR RED, GREEN, BLUE
	PRINTBUTTON "[Ｖｉ]↑", 8
	RESETCOLOR
	
	PRINTFORM 　
	RED3 = MAX(0, RED3-RED3:1)
	GREEN3 = MAX(0, GREEN3-GREEN3:1)
	BLUE3 = MAX(0, BLUE3-BLUE3:1)
	
	SIF RED3 > 255
		RED3 = 255
	SIF GREEN3 > 255
		GREEN3 = 255
	SIF BLUE3 > 255
		BLUE3 = 255
	
	SETCOLOR RED3, GREEN3, BLUE3
	PRINTBUTTON "[Ｖｏ]→", 1
	RESETCOLOR
	
	;画面合わせ用バーストアピール
	IF BASE:0:ボルテージ >= 10000
		SETCOLOR GETBGCOLOR()
		PRINTFORM 　 
		LOCALS = [ＢＡ]%UNICODE(0x2196)%
		PRINTFORM LOCALS
		RESETCOLOR
	ELSE
	
	ENDIF
	
	PRINTL 
	PRINTL
	CALL SHOW_RATE_DA
	PRINT 　　
	CALL SHOW_RATE_VI
	PRINT 　　
	CALL SHOW_RATE_VO
	PRINTL
	PRINTL
	
	PRINTBUTTON "[思い出]", 2
	PRINTL
	PRINTL

	PRINTBUTTON "[ノーアピール]↓", 3
	PRINTL 
	SETFONT RESULTS
	IF (LOCAL:1) == 0
		LOCAL += 1
		SIF LOCAL == 34
			LOCAL:1 = 1
	ELSEIF (LOCAL:1) == 1
		LOCAL -= 1
		SIF LOCAL == 0
			LOCAL:1 = 0
	ENDIF
	PRINTL
	PRINTL
	PRINTL
	PRINTL
	ALIGNMENT LEFT
	SIF REPEATCOUNT == ARG + 1
		GOTO END_LOOP
	TINPUT 100, -999, 0
	IF RESULT == -999
		REPEATCOUNT += 1
		CALL RETURNLINE
		GOTO REPEAT_LOOP
	ELSE
		SELECTCASE REPEATCOUNT
			CASE 0 TO 2
			;BAD
				TFLAG:アピール成功 = 0
				LOCAL = RESULT
			;GOOD
			CASE 3 TO 4
				TFLAG:アピール成功 = 1
				LOCAL = RESULT
			;PERFECT
			CASE 5 TO 6
				TFLAG:アピール成功 = 2
				LOCAL = RESULT
			;エラー
			CASEELSE
				TFLAG:アピール成功 = 0
				LOCAL = 3
		ENDSELECT
	ENDIF
	RESETCOLOR
	RETURN LOCAL
	$END_LOOP
	RESETCOLOR
	TFLAG:アピール成功 = 0
	LOCAL = 3
	PRINTL 
	RETURN LOCAL
	