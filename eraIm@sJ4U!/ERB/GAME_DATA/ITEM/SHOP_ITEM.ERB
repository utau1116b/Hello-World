
;---------------------------------------------------------
;アイテム出現条件
;---------------------------------------------------------
@SALEITEM_CHECK
;1つ以上持ってる場合はITEMSALESを0にする。持ってない場合は販売中(ITEMSALESが1)になる
;既にアイテムがあるのに販売中になっているという不自然な状態をここでまとめてチェックする
FOR LOCAL, 0, 100
	SIF STRLENS(ITEMNAME:LOCAL) == 0
		CONTINUE
	IF ITEM:LOCAL
		ITEMSALES:LOCAL = 0
	ELSE
		ITEMSALES:LOCAL = 1
	ENDIF
NEXT

;ローション、媚薬、ビデオテープはとりあえず99個まで
ITEMSALES:25 = 1
ITEMSALES:26 = 1
ITEMSALES:27 = 1
ITEMSALES:28 = 1
ITEMSALES:29 = 1
ITEMSALES:30 = 1
ITEMSALES:31 = 1
ITEMSALES:33 = 1
ITEMSALES:34 = 1
ITEMSALES:35 = 1
SIF ITEM:25 >= 99
	ITEMSALES:25 = 0
SIF ITEM:26 >= 99
	ITEMSALES:26 = 0
SIF ITEM:27 >= 99
	ITEMSALES:27 = 0
SIF ITEM:28 >= 99
	ITEMSALES:28 = 0
SIF ITEM:29 >= 99
	ITEMSALES:29 = 0
SIF ITEM:30 >= 99
	ITEMSALES:30 = 0
SIF ITEM:31 >= 99
	ITEMSALES:31 = 0
SIF ITEM:33 >= 99
	ITEMSALES:33 = 0
SIF ITEM:34 >= 99
	ITEMSALES:34 = 0
SIF ITEM:35 >= 99
	ITEMSALES:35 = 0

IF (FLAG:62 & 1) == 0
	ITEMSALES:33 = 0
	ITEMSALES:34 = 0
ENDIF
;主人か助手が『禁断の知識』を持っている
F = 0
IF TALENT:MASTER:125
	F = 1
	ITEMSALES:66 = 0
ELSEIF ASSI >= 0
	SIF TALENT:ASSI:125
		F = 1
ENDIF
;助手全体から禁断の知識を検索
REPEAT CHARANUM
	IF COUNT == 0
		CONTINUE
	ELSEIF CFLAG:COUNT:21
		CONTINUE
	ELSEIF ISASSI:COUNT == 1
		SIF TALENT:COUNT:125
			F = 1
	ENDIF
REND

;主人か助手が『調合知識』を持っている
P = 0
IF TALENT:MASTER:55
	P = 1
	ITEMSALES:65 = 0
ELSEIF ASSI >= 0
	SIF TALENT:ASSI:55
		P = 1
ENDIF
;助手全体から調合知識を検索
REPEAT CHARANUM
	IF COUNT == 0
		CONTINUE
	ELSEIF CFLAG:COUNT:21
		CONTINUE
	ELSEIF ISASSI:COUNT == 1
		SIF TALENT:COUNT:55
			P = 1
	ENDIF
REND

ITEMSALES:71 = 0
ITEMSALES:72 = 0
ITEMSALES:73 = 0
ITEMSALES:74 = 0
ITEMSALES:75 = 0
ITEMSALES:76 = 0
ITEMSALES:77 = 0
ITEMSALES:78 = 0
ITEMSALES:79 = 0
ITEMSALES:80 = 0
ITEMSALES:81 = 0
IF F || P
	REPEAT CHARANUM
		SIF CFLAG:COUNT:21
			CONTINUE
		SIF CFLAG:COUNT:勧誘状況 != -1
			CONTINUE
		;71,薬の材料(双),20000,;ふたなりにする
		;既になっていたらダメ
		IF TALENT:COUNT:121 == 0 && TALENT:COUNT:122 == 0
			;禁断の知識がない場合、対象に調合知識か不思議な根か具現が必要
			SIF F || (TALENT:COUNT:55 || TALENT:COUNT:120 || TALENT:COUNT:127)
				ITEMSALES:71 = 1
		ENDIF
		;72,薬の材料(消),10000,;ふたなりを消去する
		SIF TALENT:COUNT:121 && TALENT:COUNT:122 == 0
			ITEMSALES:72 = 1
		;73,青の飴玉,20000,;体が成長するキャンディ。母乳体質になる
		;すでに母乳体質だとダメ、禁断の知識でないとダメ
		SIF F && TALENT:COUNT:130 == 0 && TALENT:COUNT:122 == 0
			ITEMSALES:73 = 1
		;74,赤の飴玉,20000,;体が若返るキャンディ。処女膜が再生する
		;処女は対象外、禁断の知識でないとダメ
		SIF F && TALENT:COUNT:0 == 0 && TALENT:COUNT:122 == 0
			ITEMSALES:74 = 1
		;アリスをロリ化する(東方専用)
		SIF F && NO:COUNT == 14 && TALENT:COUNT:0 && CFLAG:COUNT:0 == 0 && NAME_CSV(NO:COUNT, 1) == "ちびアリス"
			ITEMSALES:74 = 1
		;75,豊胸剤,20000,;胸の大きさを1段階上げる。
		;爆乳だとダメ
		SIF TALENT:COUNT:122 == 0 && TALENT:COUNT:141 == 0
			ITEMSALES:75 = 1
		;76,縮胸剤,10000,;胸の大きさを1段階下げる。
		;絶壁だとダメ
		SIF TALENT:COUNT:122 == 0 && TALENT:COUNT:140 == 0
			ITEMSALES:76 = 1
		;77,止乳剤,5000,;母乳が出なくなる
		;母乳体質じゃないとダメ
		SIF TALENT:COUNT:130 && TALENT:COUNT:122 == 0
			ITEMSALES:77 = 1
		;78,尿漏れ改善薬,5000,;お漏らし癖が直る。
		;お漏らし癖じゃないとダメ
		SIF TALENT:COUNT:57
			ITEMSALES:78 = 1
		;79,黄の飴玉,20000,;卵を産ませる
		;妊娠中もしくは産卵経験が1以上じゃないとダメ
		SIF TALENT:COUNT:134 || EXP:COUNT:60 > 0
			ITEMSALES:79 = 1
		;80,金の飴玉,30000,;小柄体型持ちを成長させる
		;小柄体系でないとダメ
		SIF TALENT:COUNT:100
			ITEMSALES:80 = 1
		;81,黒の飴玉,50000,;EX化させる
		;まだEX化していなくて、EX化が可能なキャラでないと使用できない
		SIF CFLAG:COUNT:0 == 0 && ABLE_EX_CHANGES(COUNT)
			ITEMSALES:81 = 1
	REND
ENDIF

;エンゲージリング（Jではコマンド：プレゼントで渡す）
ITEMSALES:85 = 0

;赤い首輪（奴隷エンド条件はここで処理）
ITEMSALES:86 = 0
IF TARGET > 0 && ASSI < 0 && FLAG:5 != 9 && ITEM:85 == 0 && ITEM:86 == 0
	SIF TALENT:76 && TALENT:85 && TALENT:89 == 0 && TALENT:180 == 0 && CFLAG:2 >= 2500 && MARK:2 >= 3 && MARK:3 == 0 && (ABL:0+ABL:1+ABL:6 >= 15) && (ABL:2+ABL:8+ABL:11 >= 13) && (EXP:0+EXP:1 >= 200) && EXP:11 >= 150 && EXP:22 >= 150 && EXP:40 < 500
		ITEMSALES:86 = 1
ENDIF

;隷属の証
ITEMSALES:87 = 0
IF TARGET > 0 && ASSI < 0 && FLAG:1 < 9
	IF TALENT:MASTER:122 && EXP:40 >= 1500
		ITEMSALES:87 = 0
	ELSEIF TALENT:76 && TALENT:85 && TALENT:89 == 0 && TALENT:180 == 0 && MARK:2 >= 3 && MARK:3 == 0 && (ABL:0+ABL:1 >= 8) && (ABL:2+ABL:6 >= 7) && (ABL:8 >= 2 && ABL:10 >= 2 && ABL:11 >= 2) && (EXP:0+EXP:1 >= 100) && EXP:11 >= 50 && EXP:22 >= 50
		ITEMSALES:87 = 1
	ENDIF
ENDIF

;触手使役術
ITEMSALES:24 = 0
SIF F == 1 && ITEM:24 == 0
	ITEMSALES:24 = 1

;元気になる薬
ITEMSALES:70 = 0
IF P
	REPEAT CHARANUM
		SIF CFLAG:COUNT:21
			CONTINUE
		SIF BASE:COUNT:0 != MAXBASE:COUNT:0
			ITEMSALES:70 = 1
	REND
ENDIF

;記憶消去薬
ITEMSALES:98 = 0
SIF F && P
	ITEMSALES:98 = 1

;汚れ無視
ITEMSALES:62 = 0
SIF TALENT:MASTER:64 == 0
	ITEMSALES:62 = 1

;サド
ITEMSALES:63 = 0
SIF TALENT:MASTER:83 == 0
	ITEMSALES:63 = 1

;主人がオトコかふたなりで、早漏ではない
ITEMSALES:64 = 0
SIF (TALENT:MASTER:121 || TALENT:MASTER:122) && TALENT:MASTER:133 == 0
	ITEMSALES:64 = 1


;調合知識(封印中)
ITEMSALES:65 = 0
SIF F && P
	ITEMSALES:65 = 1

;技巧
ITEMSALES:60 = 0
SIF ABL:MASTER:2 < 99
	ITEMSALES:60 = 1

;撮影技能
ITEMSALES:61 = 0
SIF ITEM:6 && ABL:MASTER:91 < 99
	ITEMSALES:61 = 1
;編集機材
ITEMSALES:59 = 0
SIF ITEM:6 && ITEM:59 == 0
	ITEMSALES:59 = 1

;プラカード
ITEMSALES:46 = 0
SIF FLAG:1 >= 1 && ITEM:46 == 0
	ITEMSALES:46 = 1

;初月の証
SIF ITEM:99 == 0
	ITEMSALES:99 = 1

;結界操作と変身魔法
ITEMSALES:67 = 0
ITEMSALES:68 = 0
SIF TALENT:MASTER:211 == 0 && F
	ITEMSALES:67 = 1
SIF TALENT:MASTER:212 == 0 && F
	ITEMSALES:68 = 1

;83,虹の飴玉,500000,;プレイヤーの性別を変える
ITEMSALES:83 = 0
SIF F && P
	ITEMSALES:83 = 1

;---------------------------------------------------------
;複数個所持可能なアイテムについて、同時購入個数を選択
;---------------------------------------------------------
@BUY_PLURAL(ARG)
;現在の購入可能数、Bは所持可能最大数（現在100個）、Cは所持金によるもの
;普通に99個までしか買える仕様になってないし、最大数は99個と判断
;ここに飛んで来た時点で一個購入してしまってるので、払い戻し処理をしておく
LOCAL = ARG
MONEY += ITEMPRICE:LOCAL
ITEM:LOCAL -= 1
DRAWLINE
PRINTFORML %ITEMNAME:LOCAL%をいくつ買いますか？ (現在 {ITEM:LOCAL}個所持)
CALL INPUT_MANY(0, MIN(MONEY/ITEMPRICE:LOCAL, 99 - ITEM:LOCAL))
IF RESULT == 0
	RETURN 0
ELSEIF RESULT == 1
	PRINTFORMW ＜%ITEMNAME:LOCAL%を購入しました＞
	ITEM:LOCAL += RESULT
	MONEY -= ITEMPRICE:LOCAL*RESULT
	RETURN 0
ELSE
	PRINTFORMW ＜%ITEMNAME:LOCAL%を{RESULT}個購入しました＞
	ITEM:LOCAL += RESULT
	MONEY -= ITEMPRICE:LOCAL*RESULT
	RETURN 0
ENDIF
;アイテム使用
@USE_ITEM(ARG)
DRAWLINE
PRINTFORM %ITEMNAME:ARG%:
;アイテムの効果を表示する
SIF ARG == 70
	PRINTL 体力を回復します
SIF ARG == 71
	PRINTL ふたなりになります
SIF ARG == 72
	PRINTL ふたなりを消去します
SIF ARG == 73
	PRINTL 母乳体質になります
SIF ARG == 74
	PRINTL 処女膜が再生します
SIF ARG == 75
	PRINTL 胸を大きくします
SIF ARG == 76
	PRINTL 胸を小さくします
SIF ARG == 77
	PRINTL 母乳が出なくなります
SIF ARG == 78
	PRINTL お漏らし癖が治ります
SIF ARG == 79
	PRINTL 強制的に卵を産ませます
SIF ARG == 80
	PRINTL 成長させます
SIF ARG == 81
	PRINTL EX化させます
SIF ARG == 83
	PRINTL 性別を反転させます
SIF ARG == 85
	PRINTL 自分の気持ちを伝えます
SIF ARG == 86
	PRINTL 最高の妻にして奴隷である証を与えます
SIF ARG == 87
	PRINTL 烙印を押して自分の妾にします
SIF ARG == 98
	PRINTL 調教の記憶を消去します

IF ARG == 86 || ARG == 87
	PRINTL 誰に与えますか？
ELSE
	PRINTL 誰に使いますか？
ENDIF

;改行用変数
LOCAL:0 = 0
REPEAT CHARANUM
	TFLAG:COUNT = 0
	;加入していないキャラには使えない
	SIF CFLAG:COUNT:勧誘状況 != -1
		CONTINUE
	;別れ中のキャラには使えない
	SIF CFLAG:COUNT:21
		CONTINUE
	SIF ARG == 70 && BASE:COUNT:0 == MAXBASE:COUNT:0
		CONTINUE
	SIF ARG == 71 && (TALENT:COUNT:121 || TALENT:COUNT:122)
		CONTINUE
	SIF ARG == 71 && F == 0 && TALENT:COUNT:55 == 0 && TALENT:COUNT:120 == 0 && TALENT:COUNT:127 == 0
		CONTINUE
	SIF ARG == 72 && (TALENT:COUNT:121 == 0 || TALENT:COUNT:122)
		CONTINUE
	SIF ARG == 73 && (TALENT:COUNT:130 || TALENT:COUNT:122)
		CONTINUE
	IF ARG == 74 && (TALENT:COUNT:0 || TALENT:COUNT:122)
		SIF NO:COUNT != 14 || CFLAG:COUNT:0 || NAME_CSV(NO:COUNT, 1) != "ちびアリス"
			CONTINUE
		;主人時は不可
		SIF COUNT == 0
			CONTINUE
	ENDIF
	SIF ARG == 75 && (TALENT:COUNT:141 || TALENT:COUNT:122)
		CONTINUE
	SIF ARG == 76 && (TALENT:COUNT:140 || TALENT:COUNT:122)
		CONTINUE
	SIF ARG == 77 && (TALENT:COUNT:130 == 0 || TALENT:COUNT:122)
		CONTINUE
	SIF ARG == 78 && TALENT:COUNT:57 == 0
		CONTINUE
	SIF ARG == 79 && (TALENT:COUNT:122 || (TALENT:COUNT:134 == 0 && EXP:COUNT:60 == 0) || BASE:COUNT:0 < 1000)
		CONTINUE
	SIF ARG == 80 && TALENT:COUNT:100 == 0
		CONTINUE
	SIF ARG == 81 && (CFLAG:COUNT:0 || ABLE_EX_CHANGES(COUNT) == 0)
		CONTINUE
	;性別反転
	SIF ARG == 83 && (TALENT:COUNT:妊娠 || TALENT:COUNT:育児中 || MARK:COUNT:90)
		CONTINUE
	SIF ARG == 85 && COUNT != TARGET
		CONTINUE
	SIF ARG == 86 && COUNT != TARGET
		CONTINUE
	SIF ARG == 87 && COUNT != TARGET
		CONTINUE
	SIF ARG == 98 && COUNT == 0
		CONTINUE
	PRINTFORM [{COUNT,2}]%NAME:COUNT,16,LEFT%　
	IF ARG == 70
		;元気になる薬は体力を表示して1行表示
		PRINTFORML 体力({BASE:COUNT:0,4}/{MAXBASE:COUNT:0,4})
		TFLAG:COUNT = 1
		CONTINUE
	ENDIF
	
	;3行表示
	LOCAL:0 += 1
	IF LOCAL:0 == 3
		PRINTL 
		LOCAL:0 = 0
	ENDIF
	TFLAG:COUNT = 1
	
REND

SIF LOCAL:0 != 0
	PRINTL 
IF CHARANUM <= 100
	PRINTL [100] 戻る
ELSE
	PRINTL [1000][-1] 戻る
ENDIF

$INPUT_LOOP
INPUT
IF RESULT == -1 || (CHARANUM <= 100 && RESULT == 100) || RESULT == 1000
	ITEM:ARG = 0
	;払い戻し
	MONEY += ITEMPRICE:ARG
	RETURN 0
ELSE
	IF RESULT < 0 || RESULT >= CHARANUM
		PRINTFORML 正しい値を入力してください
		GOTO INPUT_LOOP
	ELSEIF TFLAG:RESULT == 0
		PRINTFORML 正しい値を入力してください
		GOTO INPUT_LOOP
	ENDIF
ENDIF

;TFLAG初期化
TFLAG:13 = 0
TFLAG:600 = 0
;体力回復
IF ARG == 70
	PRINTFORMW ＜%NAME:RESULT%の体力が回復した＞
	BASE:RESULT:0 += 300
	SIF BASE:RESULT:0 > MAXBASE:RESULT:0
		BASE:RESULT:0 = MAXBASE:RESULT:0
	TFLAG:600 = 50
ENDIF
;ふたなり化
IF ARG == 71
	PRINTFORMW ＜%NAME:RESULT%をふたなり化した＞
	TALENT:RESULT:120 = 0
	TALENT:RESULT:127 = 0
	TALENT:RESULT:121 = 1
	TFLAG:600 = 51
ENDIF
;ふたなりを消去
IF ARG == 72
	PRINTFORMW ＜%NAME:RESULT%はふたなりではなくなった＞
	TALENT:RESULT:121 = 0
	TFLAG:600 = 52
ENDIF
;母乳体質
IF ARG == 73
	PRINTFORMW ＜%NAME:RESULT%は母乳が出るようになった＞
	TALENT:RESULT:130 = 1
	TFLAG:600 = 53
ENDIF
;処女膜再生
IF ARG == 74
	LOCAL = RESULT
	;条件が揃っているならアリスをSP化(東方専用)
	IF NO:LOCAL == 14 && TALENT:LOCAL:0 && CFLAG:LOCAL:0 == 0 && NAME_CSV(NO:LOCAL, 1) == "ちびアリス"
		IF TARGET >= 0
			T = NO:TARGET
		ELSE
			T = -1
		ENDIF
		IF ASSI >= 0
			A = NO:ASSI
		ELSE
			A = -1
		ENDIF
		P = TALENT:LOCAL:150
		DELCHARA LOCAL
		ADDSPCHARA 14
		A = CHARANUM - 1
		;【パートナー】引継ぎ
		TALENT:A:150 = P
		;キャラ加入時の共通設定
		CALL NEWCHARA_INIT

		PRINTFORMW ＜アリスは子供の姿になった＞
		REPEAT CHARANUM
			SIF NO:COUNT == T
				TARGET = COUNT
			SIF NO:COUNT == A
				ASSI = COUNT
		REND
		SIF A == 14
			ASSI = -1
	ELSE
		PRINTFORMW ＜%NAME:LOCAL%の処女膜が再生された＞
		TALENT:LOCAL:0 = 1
		;素質発覚
		SIF FLAG:2 == 1 && (CFLAG:60 & 1) == 0
			CFLAG:60 |= 1
	ENDIF
	TFLAG:600 = 54
ENDIF
;豊乳化
IF ARG == 75
	;素質発覚（隠し様がないね）
	SIF FLAG:2 == 1 && (CFLAG:RESULT:60 & 32) == 0
			CFLAG:RESULT:60 |= 32
	;貧乳
	IF TALENT:RESULT:109
		PRINTFORMW ＜%NAME:RESULT%の胸が人並みに大きくなった＞
		TALENT:RESULT:109 = 0
	;絶壁
	ELSEIF TALENT:RESULT:140
		PRINTFORMW ＜%NAME:RESULT%の胸が大きくなった＞
		TALENT:RESULT:140= 0
		TALENT:RESULT:109 = 1
	;巨乳
	ELSEIF TALENT:RESULT:110
		PRINTFORMW ＜%NAME:RESULT%の胸が体に不釣合いなまでに大きくなった＞
		TALENT:RESULT:110 = 0
		TALENT:RESULT:141 = 1
	;並乳
	ELSE
		IF TALENT:RESULT:100
			PRINTFORMW ＜%NAME:RESULT%の胸が体に不釣合いなまでに大きくなった＞
		ELSE
			PRINTFORMW ＜%NAME:RESULT%の胸がはち切れんばかりの大きさになった＞
		ENDIF
		TALENT:RESULT:110 = 1
	ENDIF
	TFLAG:600 = 55
ENDIF
;虚乳
IF ARG == 76
	;素質発覚（隠し様がないね）
	SIF FLAG:2 == 1 && (CFLAG:RESULT:60 & 32) == 0
			CFLAG:RESULT:60 |= 32
	;巨乳
	IF TALENT:RESULT:110
		PRINTFORMW ＜%NAME:RESULT%の胸が人並みに小さくなった＞
		PRINTFORMW %NAME:RESULT%はショックを受けているようだ

		TALENT:RESULT:110 = 0
	;爆乳
	ELSEIF TALENT:RESULT:141
		PRINTFORMW ＜%NAME:RESULT%の胸が小さくなった＞
		PRINTFORMW %NAME:RESULT%はショックを受けているようだ
		TALENT:RESULT:141 = 0
		TALENT:RESULT:110 = 1
	;貧乳
	ELSEIF TALENT:RESULT:109
			PRINTFORMW ＜%NAME:RESULT%の胸が極端に薄くなった＞
			PRINTFORMW %NAME:RESULT%は愕然としている
			TALENT:RESULT:109 = 0
			TALENT:RESULT:140 = 1
	;並乳
	ELSE
		IF TALENT:RESULT:100
			PRINTFORMW ＜%NAME:RESULT%の胸が見かけ相当に薄くなった＞
			PRINTFORMW %NAME:RESULT%は少々ショックを受けているようだ
		ELSE
			PRINTFORMW ＜%NAME:RESULT%の胸が薄くなった＞
			PRINTFORMW %NAME:RESULT%は少々ショックを受けているようだ
		ENDIF
		TALENT:RESULT:109 = 1
	ENDIF
	TFLAG:600 = 56
ENDIF
;母乳治療
IF ARG == 77
	PRINTFORMW ＜%NAME:RESULT%は母乳が出なくなった＞
	TALENT:RESULT:130 = 0
	TFLAG:600 = 57
ENDIF
;お漏らし治療
IF ARG == 78
	PRINTFORMW ＜%NAME:RESULT%のお漏らし癖が治った＞
	TALENT:RESULT:57 = 0
	EXP:RESULT:31 = 0
	TFLAG:600 = 58
ENDIF
;卵を産ませる
IF ARG == 79
	A = RESULT
	PRINTFORML ＜%NAME:A%に卵を産ませますか？＞
	PRINTW ※日付が数日飛びます
	DRAWLINE
	PRINTL [0] - 今はやめておく
	PRINTL [1] - 産ませる
	DRAWLINE
	$INPUT_LOOP_EGG
	INPUT
	IF RESULT == 1
		TARGET = A
		CALL LAY_EGG
	ELSEIF RESULT == 0
		MONEY += 20000
		RETURN 0
	ELSE
		PRINTFORML 正しい値を入力してください
		GOTO INPUT_LOOP_EGG
	ENDIF
ENDIF

;成長薬
IF ARG == 80
	PRINTFORMW ＜%NAME:RESULT%の体が成長した＞
	TALENT:RESULT:100 = 0
	IF TALENT:RESULT:109
		PRINTFORMW ＜%NAME:RESULT%の胸が大きくなった＞
		TALENT:RESULT:109 = 0
	ELSEIF TALENT:RESULT:110 == 0
		PRINTFORMW ＜%NAME:RESULT%の胸がはち切れんばかりの大きさになった＞
		TALENT:RESULT:110 = 1
	ENDIF
ENDIF

;EX化
IF ARG == 81

ENDIF

;性転換
SIF ARG == 83
	;虹の飴玉(性転換)
	CALL USE_DRUG_83(RESULT)

;記憶消去
IF ARG == 98
	PRINTFORMW ＜%NAME:RESULT%は%CALLNAME:MASTER%との記憶を失った＞
	R = RESULT
	
	;元のTARGETを避難させて、TARGET を Rに
	A = TARGET
	TARGET = R
	;口上用に一時的に素質追加処理
	TALENT:TARGET:85 = TALENT:R:85
	TALENT:TARGET:88 = TALENT:R:88
	TALENT:TARGET:89 = TALENT:R:89
	TALENT:TARGET:135 = TALENT:R:135
	TALENT:TARGET:76 = TALENT:R:76
	TALENT:TARGET:74 = TALENT:R:74
	TALENT:TARGET:75 = TALENT:R:75
	TALENT:TARGET:77 = TALENT:R:77
	TALENT:TARGET:78 = TALENT:R:78
	TALENT:TARGET:155 = TALENT:R:155
	TALENT:TARGET:79 = TALENT:R:79
	TALENT:TARGET:83 = TALENT:R:83
	MARK:TARGET:0 = MARK:R:0
	MARK:TARGET:1 = MARK:R:1
	MARK:TARGET:2 = MARK:R:2
	MARK:TARGET:3 = MARK:R:3

	;融通が利くように口上はここに
	TFLAG:600 = 59
	CALL KOJO_MESSAGE_SEND("JUN")

	;口上用に一時的に追加した素質の消去処理
	TALENT:TARGET:85 = 0
	TALENT:TARGET:88 = 0
	TALENT:TARGET:89 = 0
	TALENT:TARGET:135 = 0
	TALENT:TARGET:76 = 0
	TALENT:TARGET:74 = 0
	TALENT:TARGET:75 = 0
	TALENT:TARGET:77 = 0
	TALENT:TARGET:78 = 0
	TALENT:TARGET:155 = 0
	TALENT:TARGET:79 = 0
	TALENT:TARGET:83 = 0
	MARK:TARGET:0 = 0
	MARK:TARGET:1 = 0
	MARK:TARGET:2 = 0
	MARK:TARGET:3 = 0

	;汎用キャラは保存素質追加
	;IF NO:TARGET == 99
	;	TALENT:TARGET:10 = TALENT:R:10
	;	TALENT:TARGET:11 = TALENT:R:11
	;	TALENT:TARGET:12 = TALENT:R:12
	;	TALENT:TARGET:13 = TALENT:R:13
	;	TALENT:TARGET:14 = TALENT:R:14
	;	TALENT:TARGET:15 = TALENT:R:15
	;	TALENT:TARGET:16 = TALENT:R:16
	;	TALENT:TARGET:17 = TALENT:R:17
	;	TALENT:TARGET:18 = TALENT:R:18
	;	TALENT:TARGET:20 = TALENT:R:20
	;	TALENT:TARGET:21 = TALENT:R:21
	;	TALENT:TARGET:22 = TALENT:R:22
	;	TALENT:TARGET:23 = TALENT:R:23
	;	TALENT:TARGET:24 = TALENT:R:24
	;	TALENT:TARGET:25 = TALENT:R:25
	;	TALENT:TARGET:26 = TALENT:R:26
	;	TALENT:TARGET:27 = TALENT:R:27
	;	TALENT:TARGET:28 = TALENT:R:28
	;	TALENT:TARGET:30 = TALENT:R:30
	;	TALENT:TARGET:31 = TALENT:R:31
	;	TALENT:TARGET:32 = TALENT:R:32
	;	TALENT:TARGET:33 = TALENT:R:33
	;	TALENT:TARGET:34 = TALENT:R:34
	;	TALENT:TARGET:35 = TALENT:R:35
	;	TALENT:TARGET:36 = TALENT:R:36
	;	TALENT:TARGET:37 = TALENT:R:37
	;	TALENT:TARGET:50 = TALENT:R:50
	;	TALENT:TARGET:51 = TALENT:R:51
	;	TALENT:TARGET:52 = TALENT:R:52
	;	TALENT:TARGET:53 = TALENT:R:53
	;	TALENT:TARGET:54 = TALENT:R:54
	;	TALENT:TARGET:55 = TALENT:R:55
	;	TALENT:TARGET:60 = TALENT:R:60
	;	TALENT:TARGET:61 = TALENT:R:61
	;	TALENT:TARGET:62 = TALENT:R:62
	;	TALENT:TARGET:63 = TALENT:R:63
	;	TALENT:TARGET:64 = TALENT:R:64
	;	TALENT:TARGET:70 = TALENT:R:70
	;	TALENT:TARGET:71 = TALENT:R:71
	;	TALENT:TARGET:72 = TALENT:R:72
	;	TALENT:TARGET:80 = TALENT:R:80
	;	TALENT:TARGET:81 = TALENT:R:81
	;	TALENT:TARGET:82 = TALENT:R:82
	;	TALENT:TARGET:83 = TALENT:R:83
	;	TALENT:TARGET:84 = TALENT:R:84
	;	TALENT:TARGET:87 = TALENT:R:87
	;	TALENT:TARGET:118 = TALENT:R:118
	;	TALENT:TARGET:132 = TALENT:R:132
	;ENDIF
	TALENT:TARGET:0 = TALENT:R:0
	TALENT:TARGET:40 = TALENT:R:40
	TALENT:TARGET:41 = TALENT:R:41
	TALENT:TARGET:42 = TALENT:R:42
	TALENT:TARGET:43 = TALENT:R:43
	TALENT:TARGET:56 = TALENT:R:56
	TALENT:TARGET:100 = TALENT:R:100
	TALENT:TARGET:101 = TALENT:R:101
	TALENT:TARGET:102 = TALENT:R:102
	TALENT:TARGET:103 = TALENT:R:103
	TALENT:TARGET:104 = TALENT:R:104
	TALENT:TARGET:105 = TALENT:R:105
	TALENT:TARGET:106 = TALENT:R:106
	TALENT:TARGET:107 = TALENT:R:107
	TALENT:TARGET:108 = TALENT:R:108
	TALENT:TARGET:109 = TALENT:R:109
	TALENT:TARGET:110 = TALENT:R:110
	TALENT:TARGET:111 = TALENT:R:111
	TALENT:TARGET:112 = TALENT:R:112
	TALENT:TARGET:113 = TALENT:R:113
	TALENT:TARGET:114 = TALENT:R:114
	TALENT:TARGET:115 = TALENT:R:115
	TALENT:TARGET:116 = TALENT:R:116
	TALENT:TARGET:120 = TALENT:R:120
	TALENT:TARGET:121 = TALENT:R:121
	TALENT:TARGET:122 = TALENT:R:122
	TALENT:TARGET:124 = TALENT:R:124
	;被写経験がリセットされないようなので人気はそのまま
	TALENT:TARGET:126 = TALENT:R:126
	TALENT:TARGET:128 = TALENT:R:128
	TALENT:TARGET:130 = TALENT:R:130
	TALENT:TARGET:134 = TALENT:R:134
	TALENT:TARGET:150 = TALENT:R:150

	TALENT:TARGET:213 = TALENT:R:213
	TALENT:TARGET:214 = TALENT:R:214
	TALENT:TARGET:215 = TALENT:R:215
	TALENT:TARGET:218 = TALENT:R:218
	
	
	EXP:TARGET:0 = EXP:R:0
	EXP:TARGET:1 = EXP:R:1
	EXP:TARGET:2 = EXP:R:2
	EXP:TARGET:3 = EXP:R:3
	EXP:TARGET:10 = EXP:R:10
	EXP:TARGET:11 = EXP:R:11
	EXP:TARGET:20 = EXP:R:20
	EXP:TARGET:21 = EXP:R:21
	EXP:TARGET:22 = EXP:R:22
	EXP:TARGET:23 = EXP:R:23
	EXP:TARGET:30 = EXP:R:30
	EXP:TARGET:31 = EXP:R:31
	EXP:TARGET:32 = EXP:R:32
	EXP:TARGET:40 = EXP:R:40
	EXP:TARGET:41 = EXP:R:41
	EXP:TARGET:50 = EXP:R:50
	EXP:TARGET:51 = EXP:R:51
	EXP:TARGET:52 = EXP:R:52
	EXP:TARGET:53 = EXP:R:53
	EXP:TARGET:54 = EXP:R:54
	EXP:TARGET:55 = EXP:R:55
	EXP:TARGET:56 = EXP:R:56
	EXP:TARGET:60 = EXP:R:60
	EXP:TARGET:61 = EXP:R:61
	EXP:TARGET:90 = EXP:R:90
	EXP:TARGET:91 = EXP:R:91
	EXP:TARGET:被写経験 = EXP:R:被写経験
	EXP:TARGET:歌唱経験 = EXP:R:歌唱経験
	ABL:TARGET:3 = ABL:R:3
	ABL:TARGET:4 = ABL:R:4
	ABL:TARGET:5 = ABL:R:5
	ABL:TARGET:14 = ABL:R:14
	
	BASE:TARGET:0 = BASE:R:0
	MAXBASE:TARGET:0 = MAXBASE:R:0
;	BASE:TARGET:1 = BASE:R:1
;	MAXBASE:TARGET:1 = MAXBASE:R:1
	MAXBASE:TARGET:2 = MAXBASE:R:2
	MAXBASE:TARGET:3 = MAXBASE:R:3
	BASE:TARGET:HP = BASE:R:HP
	MAXBASE:TARGET:HP = MAXBASE:R:HP
	BASE:TARGET:MP = BASE:R:MP
	MAXBASE:TARGET:MP = MAXBASE:R:MP
	
	
	CFLAG:TARGET:15 = CFLAG:R:15
	CFLAG:TARGET:17 = CFLAG:R:17
	CFLAG:TARGET:18 = CFLAG:R:18
	CFLAG:TARGET:19 = CFLAG:R:19
	CFLAG:TARGET:20 = CFLAG:R:20
	;加入した時ではなく記憶を消した時の異常経験の値を入れるように
	CFLAG:TARGET:22 = EXP:R:50
	CFLAG:TARGET:81 = CFLAG:R:81
	CFLAG:TARGET:110 = CFLAG:R:110
	CFLAG:TARGET:111 = CFLAG:R:111
	
	;妊娠関連
	MARK:TARGET:89 = MARK:R:89
	MARK:TARGET:90 = MARK:R:90
	
	;月経
	CFLAG:TARGET:33 = CFLAG:R:33
	TALENT:TARGET:137 = TALENT:R:137
	TALENT:TARGET:138 = TALENT:R:138

	TALENT:TARGET:151 = 1
	;記憶消去回数
	EXP:TARGET:98 = EXP:R:98 + 1
	CFLAG:32 = 0
	;口上のバージョン情報も引き継がせる
	CFLAG:R:KOJO_VERSION = CFLAG:TARGET:KOJO_VERSION
	;恋慕
	SIF TALENT:R:85
		CFLAG:TARGET:32 |= 1
	;親愛
	SIF TALENT:R:88
		CFLAG:TARGET:32 |= 2
	;相愛
	SIF TALENT:R:89
		CFLAG:TARGET:32 |= 4
	;恋人
	SIF TALENT:R:135
		CFLAG:TARGET:32 |= 8
	;淫乱
	SIF TALENT:R:76
		CFLAG:TARGET:32 |= 16
	;淫壷
	SIF TALENT:R:74
		CFLAG:TARGET:32 |= 32
	;淫核
	SIF TALENT:R:75
		CFLAG:TARGET:32 |= 64
	;尻穴狂い
	SIF TALENT:R:77
		CFLAG:TARGET:32 |= 128
	;淫乳
	SIF TALENT:R:78
		CFLAG:TARGET:32 |= 256
	;キス魔
	SIF TALENT:R:155
		CFLAG:TARGET:32 |= 512
	;マゾ
	SIF TALENT:R:79
		CFLAG:TARGET:32 |= 1024
	;サド
	SIF TALENT:R:83
		CFLAG:TARGET:32 |= 2048
	;苦痛依存Lv3
	SIF MARK:R:0 == 3
		CFLAG:TARGET:32 |= 4096
	;快楽依存Lv3
	SIF MARK:R:1 == 3
		CFLAG:TARGET:32 |= 8192
	;既成事実Lv3
	SIF MARK:R:2 == 3
		CFLAG:TARGET:32 |= 16384
	;反発感情Lv3
	SIF MARK:R:3 == 3
		CFLAG:TARGET:32 |= 32768
	;DELCHARA R
	;TARGET = CHARANUM-1
	;助手の記憶を消すと分裂するので助手無しに
	SIF TARGET == ASSI
		ASSI = -1
	
	;TARGETを元に戻す
	TARGET = A
		
	RETURN 0
ENDIF

;単体エンド
IF ARG == 85
	PRINTFORMW %NAME:MASTER%は%NAME:TARGET%の左手を引き寄せると、その薬指に指輪をはめてやった
	TFLAG:13 = 7
	CALL SELF_KOJO
	PRINTFORMW %NAME:TARGET%は頬を染めて%NAME:MASTER%の気持ちを受け入れる旨を伝えた

	;一線越えない消滅
	IF TALENT:27
		PRINTFORMW その顔は今までに無く幸福に満ち、すべてを吹っ切ったように見えた
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:27%]を失った
		TALENT:27 = 0
	ENDIF
	PRINTFORMW %NAME:TARGET%と寄り添い、長い間抱擁を交し合っていた……
	;相愛取得
	IF TALENT:89 == 0
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:89%]を得た
		TALENT:89 = 1
	ENDIF
	;売却不可フラグ
	CFLAG:7 = 1
	WAIT

	IF FLAG:1 == 9
		;FLAG:1が9のときは特殊ハーレムエンドへ。
		;“IF FLAG:1 == 9”を奴隷エンドと分けることは可能
		;烙印9＋エンゲージのハーレムエンドはIF ITEM:85で仕分けすればいけるか？
		CALL SLAVE_ENDING
	ELSE
		CALL SINGLE_ENDING
	ENDIF
;	IF FLAG:5 != 9
;		PRINTFORMW ―――単体エンド条件達成―――
;		PRINTFORMW …………
;		PRINTFORMW ………
;		PRINTFORMW ……
;		CALL GAME_CONTINUE
;	ENDIF
ENDIF

;奴隷エンド
IF ARG == 86
	PRINTFORMW %NAME:MASTER%は%NAME:TARGET%の体を引き寄せると、その首に赤い首輪をかけてやった
	TFLAG:13 = 14
	CALL SELF_KOJO
	PRINTFORML %NAME:TARGET%は呆けたような表情を浮かべたものの、我に帰ると%NAME:MASTER%にしなだれかかり
	PRINTFORMW とろんとした瞳で見上げて服従の誓いを述べた
	PRINTFORM %NAME:TARGET%の名前が刻印されたネームプレートが
	IF TIME == 0
		PRINT 夕陽を受けて
	ELSE
		PRINT 月の光を受けて
	ENDIF
	PRINTW きらりと光っている……
	PRINTL  
	;一線越えない消滅
	IF TALENT:27
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:27%]を失った
		TALENT:27 = 0
	ENDIF
	;貞操観念消滅
	IF TALENT:30
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:30%]を失った
		TALENT:30 = 0
	ENDIF
	PRINTFORMW %NAME:MASTER%はしなだれかかっている%NAME:TARGET%の頭を長い間撫でながら
	PRINTFORMW 空を見上げ、今後の調教に思いを馳せていった……
	PRINTL  
	;服従取得
	IF TALENT:180 == 0
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:180%]を得た
		TALENT:180 = 1
	ENDIF
	;隷属取得
	IF TALENT:182 == 0
		PRINTFORMW %NAME:TARGET%は[%TALENTNAME:182%]を得た
		TALENT:182 = 1
	ENDIF
	;売却不可フラグ(首輪売却を不可にしたい場合は“;”を外してください)
;	CFLAG:7 = 1
	WAIT
	IF FLAG:1 == 9
		;FLAG:1が9のときは特殊ハーレムエンドへ。
		;“IF FLAG:1 == 9”を奴隷エンドと分けることは可能
		;烙印9＋赤い首輪のハーレムエンドはIF ITEM:86で仕分けすればいけるか？
		CALL SLAVE_ENDING
	ELSE
		CALL SINGLE_ENDING
	ENDIF

;	IF FLAG:5 != 9
;		PRINTFORMW ―――奴隷エンド条件達成―――
;		PRINTFORMW …………
;		PRINTFORMW ………
;		PRINTFORMW ……
;		CALL GAME_CONTINUE
;	ENDIF
ENDIF

;烙印
IF ARG == 87
	ITEM:87 = 0
	PRINTFORMW ※注意！　%NAME:TARGET%に烙印を押すと二度と別れられなくなります。
	PRINTW それでもいいですか？
	DRAWLINE
	PRINTFORML [0] - %NAME:TARGET%に烙印を押す
	PRINTL [100] - やめる
	DRAWLINE
	$INPUT_LOOP_RAKUIN
	INPUT
	IF RESULT == 100
		MONEY += 100000
		RETURN 0
	ELSEIF RESULT == 0
		PRINTFORMW %NAME:MASTER%は%NAME:TARGET%に烙印を押した
		;TFLAG:13 = 14を奴隷エンド口上、TFLAG:13 = 15を烙印が押された時の口上とする
		TFLAG:13 = 15
		CALL SELF_KOJO
		FLAG:1 += 1
		PRINTFORMW %NAME:TARGET%は%NAME:MASTER%の所有物となったことに
		PRINTFORMW この上ない悦びを感じているようだ……
		;一線越えない消滅
		IF TALENT:27
			PRINTFORMW %NAME:TARGET%は[%TALENTNAME:27%]を失った
			TALENT:27 = 0
		ENDIF
		PRINTFORMW %NAME:MASTER%は%NAME:TARGET%の躰に刻まれた烙印を指先で撫で、
		PRINTFORMW %NAME:TARGET%の従属心を煽りたてた
		PRINTL  
		;服従取得
		IF TALENT:180 == 0
			PRINTFORMW %NAME:TARGET%は[%TALENTNAME:180%]を得た
			TALENT:180 = 1
		ENDIF
		;烙印取得
		IF TALENT:181 == 0
			PRINTFORMW %NAME:TARGET%は[%TALENTNAME:181%]を得た
			TALENT:181 = 1
		ENDIF
		;売却不可フラグ
		CFLAG:7 = 1
		PRINTFORMW ―――%NAME:TARGET%は身も心も%NAME:MASTER%の支配下になりました―――
		PRINTFORMW …………
		PRINTFORMW ………
		PRINTFORMW ……
;		IF FLAG:1 < 9
;			PRINTFORMW ＜購入できる%ITEMNAME:87%は残り{9-FLAG:1}個です＞
;		ELSE
;			PRINTFORMW ＜%ITEMNAME:87%は売り切れました＞
;		ENDIF
		PRINTFORMW ＜%NAME:TARGET%と別れられなくなりました＞
		WAIT
	ELSE
		PRINTFORML 正しい値を入力してください
		GOTO INPUT_LOOP_RAKUIN
	ENDIF
	RETURN 1
ENDIF

;口上表示。各アイテム使用時にTFLAG:600設定（設定されていないアイテムもあり）
T = TARGET
TARGET = RESULT
CALL KOJO_MESSAGE_SEND("JUN")
TARGET = T

