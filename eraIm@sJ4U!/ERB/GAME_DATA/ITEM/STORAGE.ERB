;倉庫内のアイテムをできるだけ引き出す
@STORAGE
VARSET LOCAL

PRINTL 倉庫内のアイテムを持てる分だけ引き出しました

FOR LOCAL, 0, 2000
	SELECTCASE LOCAL
		CASE 0 TO 99
			;調教アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASE 100 TO 199
			;戦闘用アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 15
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASE 200 TO 499
			;スコア
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASE 500 TO 599
			;Ｊ系アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASE 600 TO 1499
			;装備品
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASE 1500 TO 1999
			;合成素材
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			CALL STORAGE_COMMON(LOCAL:1, LOCAL:2)
		CASEELSE
	ENDSELECT
NEXT

;ARG	アイテム番号
;ARG:1	最大所持個数
@STORAGE_COMMON(ARG:0, ARG:1)
VARSET LOCAL
LOCAL:1 = ARG:0
LOCAL:2 = ARG:1
LOCAL:3 = 0
IF ITEM:(LOCAL:1) < LOCAL:2
	LOCAL:3 = FLAG:(1500 + LOCAL:1)
	IF (LOCAL:2 - ITEM:(LOCAL:1)) < LOCAL:3
		LOCAL:3 = LOCAL:2 - ITEM:(LOCAL:1)
	ENDIF
	IF LOCAL:3
		FLAG:(1500 + LOCAL:1) -= LOCAL:3
		ITEM:(LOCAL:1) += LOCAL:3
	ENDIF
ENDIF
IF FLAG:(1500 + LOCAL:1)
	PRINTFORML %ITEMNAME:(LOCAL:1),20,LEFT% 残り {FLAG:(1500 + LOCAL:1),3}
ENDIF

;倉庫行きチェック
@CHECK_STORAGE
;純愛用アイテム
;持ちきれないアイテムを処分
;LOCAL:1	アイテム番号
;LOCAL:2	最大所持個数
FOR LOCAL, 0, 2000
	SELECTCASE LOCAL
		CASE 0 TO 99
			;調教アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASE 100 TO 199
			;戦闘用アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 15
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASE 200 TO 499
			;スコア
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASE 500 TO 599
			;Ｊ系アイテム
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASE 600 TO 1499
			;装備品
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASE 1500 TO 1999
			;合成素材
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
		CASEELSE
			LOCAL:1 = LOCAL
			LOCAL:2 = 99
			IF ITEM:(LOCAL:1) > LOCAL:2
				PRINTFORML 持ちきれない%ITEMNAME:(LOCAL:1)%を倉庫に入れました
				FLAG:(1500 + LOCAL:1) += ITEM:(LOCAL:1) - LOCAL:2
				ITEM:(LOCAL:1) = LOCAL:2
			ENDIF
	ENDSELECT
NEXT
