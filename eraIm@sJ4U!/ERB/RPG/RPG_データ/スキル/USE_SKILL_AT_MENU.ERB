;メニュー画面からスキル使用
;ARG:0	対象キャラ登録番号
;ARG:1	スキルID
@USE_SKILL_AT_MENU(ARG:0, ARG:1)
;LOCAL
;0	TEMP
;1	RESULT

LOCAL:1 = 0
TRYCCALLFORM COMABLE_{ARG:1}(ARG:0)
	LOCAL:1 = RESULT
CATCH
	LOCAL:1 = 0
ENDCATCH

;メニュー画面で使用不可能な場合、表示だけして終了
IF LOCAL:1 == 0
	CALL SHOW_SKILL_NOWAIT(ARG:0, ARG:1)
	;WAIT
	RETURN
ENDIF
IF LOCAL:1 < 0
	CALL HEARTMARK_P
	PRINTFORMW が足りません
	RETURN
ENDIF

;使用可能なら対象選択
TRYCCALLFORM SELECT_SKILL_TARGET_{ARG:1}(ARG:0)
	LOCAL:1 = RESULT
CATCH
	LOCAL:1 = 0
ENDCATCH

;キャンセルされたら終了
IF LOCAL:1 == 0
	RETURN
ENDIF
;PRINTFORMW {ARG:0}が{CFLAG:(ARG:0):行動の対象}に使用
;戦闘中ではないので、一気にスキル発動
TRYCCALLFORM USE_SKILL_{ARG:1}(ARG:0, CFLAG:(ARG:0):行動の対象)
CATCH
	PRINTFORMW エラー！未実装のスキル(ID:{ARG:1})が使用されました
ENDCATCH

;関係するフラグを掃除しておく
FOR LOCAL:0, 1095, 1097
	CFLAG:(ARG:0):(LOCAL:0) = 0
NEXT
FOR LOCAL:0, 1020, 1251
	TFLAG:(LOCAL:0) = 0
NEXT

