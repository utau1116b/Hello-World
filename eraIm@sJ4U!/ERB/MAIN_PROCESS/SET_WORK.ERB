;ARG:0 仕事番号
;セットできれば1、できなければ0を返す
@SET_WORK(ARG:0)
;LOCAL:0　変更前仕事一時保存用
;LOCAL:1 
PRINTL
CUSTOMDRAWLINE =
;朝
IF FLAG:午前の予定 != 150 && FLAG:午前の予定 != 140 && FLAG:午前の予定 != 130
	LOCALS = %GET_WORK_NAME(FLAG:午前の予定),24,LEFT%
;シナリオ
ELSEIF FLAG:午前の予定 == 150
	CALLFORM KOJO_EVENT_NAME_{TARGET}_{J}
	LOCALS = %TSTR, 24, LEFT%
;サブイベント
ELSEIF FLAG:午前の予定 == 140
	CALLFORM SUB_EVENT_NAME_{V}
	LOCALS = %TSTR, 24, LEFT%
;レッスン
ELSEIF FLAG:午前の予定 == 130
	TSTR = レッスン
	LOCALS = %TSTR, 24, LEFT%
ENDIF
LOCALS = [朝]%LOCALS%
PRINTBUTTON LOCALS, 1
PRINTL

;昼
IF FLAG:午前の予定2 != 150 && FLAG:午前の予定2 != 140 && FLAG:午前の予定2 != 130
	LOCALS = %GET_WORK_NAME(FLAG:午前の予定2),24,LEFT%
;シナリオ
ELSEIF FLAG:午前の予定2 == 150
	CALLFORM KOJO_EVENT_NAME_{TARGET}_{J}
	LOCALS = %TSTR, 24, LEFT%
;サブイベント
ELSEIF FLAG:午前の予定2 == 140
	CALLFORM SUB_EVENT_NAME_{V}
	LOCALS = %TSTR, 24, LEFT%
;レッスン
ELSEIF FLAG:午前の予定2 == 130
	TSTR = レッスン
	LOCALS = %TSTR, 24, LEFT%
ENDIF
LOCALS = [昼]%LOCALS%
PRINTBUTTON LOCALS, 3
PRINTL

;夕
;IF FLAG:午後の予定 != 150 && FLAG:午後の予定 != 140 && FLAG:午後の予定 != 130
;	LOCALS = %GET_WORK_NAME(FLAG:午後の予定),24,LEFT%
;ELSEIF FLAG:午後の予定 == 150
;	CALLFORM KOJO_EVENT_NAME_{TARGET}_{J}
;	LOCALS = %TSTR, 24, LEFT%
;ELSEIF FLAG:午後の予定 == 140
;	CALLFORM SUB_EVENT_NAME_{V}
;	LOCALS = %TSTR, 24, LEFT%
;ELSEIF FLAG:午後の予定 == 130
;	TSTR = レッスン
;	LOCALS = %TSTR, 24, LEFT%
;ENDIF
;LOCALS = [夕]%LOCALS%
;PRINTBUTTON LOCALS, 2
;PRINTL

;夜
IF FLAG:午後の予定2 != 150 && FLAG:午後の予定2 != 140 && FLAG:午後の予定2 != 130
	LOCALS = %GET_WORK_NAME(FLAG:午後の予定2),24,LEFT%
ELSEIF FLAG:午後の予定2 == 150
	CALLFORM KOJO_EVENT_NAME_{TARGET}_{J}
	LOCALS = %TSTR, 24, LEFT%
ELSEIF FLAG:午後の予定2 == 140
	CALLFORM SUB_EVENT_NAME_{V}
	LOCALS = %TSTR, 24, LEFT%
ELSEIF FLAG:午後の予定2 == 130
	TSTR = レッスン
	LOCALS = %TSTR, 24, LEFT%
ENDIF
LOCALS = [夜]%LOCALS%
PRINTBUTTON LOCALS, 4
PRINTL

DRAWLINE
PRINTBUTTONLC "[キャンセル]", -1
$INPUT_LOOP
INPUT
IF RESULT == -1
	RETURN 0
ELSEIF RESULT == 1
	LOCAL = FLAG:午前の予定
	CALL CHECK_WORK_ABL(BASE:0:10, ARG:0, LOCAL)
	IF RESULT == 1
		FLAG:午前の予定 = ARG:0
		FLAG:朝の仕事地方 = FLAG:地方フラグ
	ELSE
		FLAG:午前の予定 = LOCAL
		FLAG:朝の仕事地方 = FLAG:地方フラグ
	ENDIF
	RETURN 1
;ELSEIF RESULT == 2
;	LOCAL = FLAG:午後の予定
;	CALL CHECK_WORK_ABL(BASE:0:10, ARG:0, LOCAL)
;	IF RESULT == 1
;		FLAG:午後の予定 = ARG:0
;		FLAG:夕の仕事地方 = FLAG:地方フラグ
;	ELSE
;		FLAG:午後の予定 = LOCAL
;		FLAG:夕の仕事地方 = FLAG:地方フラグ
;	ENDIF
;	RETURN 1
ELSEIF RESULT == 3
	LOCAL = FLAG:午前の予定2
	CALL CHECK_WORK_ABL(BASE:0:10, ARG:0, LOCAL)
	IF RESULT == 1
		FLAG:午前の予定2 = ARG:0
		FLAG:昼の仕事地方 = FLAG:地方フラグ
	ELSE
		FLAG:午前の予定2 = LOCAL
		FLAG:昼の仕事地方 = FLAG:地方フラグ
	ENDIF
	RETURN 1
ELSEIF RESULT == 4
	LOCAL = FLAG:午後の予定2
	CALL CHECK_WORK_ABL(BASE:0:10, ARG:0, LOCAL)
	IF RESULT == 1
		FLAG:午後の予定2 = ARG:0
		FLAG:夜の仕事地方 = FLAG:地方フラグ
	ELSE
		FLAG:午後の予定2 = LOCAL
		FLAG:夜の仕事地方 = FLAG:地方フラグ
	ENDIF
	RETURN 1
ELSE
	REUSELASTLINE 入力値が不正です。再入力してください
	GOTO INPUT_LOOP
ENDIF

RESTART

;ARG:0 残りコスト
;ARG:1 セットする仕事番号
;ARG:2 変更前仕事
;セットできるなら1,そうでなければ0を返す
@CHECK_WORK_ABL(ARG:0, ARG:1, ARG:2)
;LOCAL:0 TEMP
;LOCAL:1 TEMP
;仕事番号が適切かチェック
IF FLAG:仕事難易度 == 0
ELSEIF FLAG:仕事難易度 == 1
ELSEIF FLAG:仕事難易度 == 2
ELSEIF FLAG:仕事難易度 == 3
ELSEIF FLAG:仕事難易度 == 4
ELSEIF FLAG:仕事難易度 == 5
ELSE
	;PRINTFORM エラー!仕事難易度が不正です！
ENDIF

;お金が足りているかチェック
;判定用にマニー一時避難
LOCAL = MONEY
;変更前仕事を外す
CALL GET_COST_MONEY(ARG:2)
LOCAL += RESULT
;変更後も足りているかチェック
CALL GET_COST_MONEY(ARG:1)

;必要マニ0ならスルー
IF RESULT <= 0

ELSE
	IF (LOCAL - RESULT) >= 0
	
	ELSE
		PRINTFORMW ゲイツが足りません！
		RETURN 0
	ENDIF
ENDIF

;コストが足りているかチェック
;変更前仕事を外す
SELECTCASE ARG:2
	CASE 100
		LOCAL = 0
	CASE 101
		LOCAL = 1
	CASE 102
		LOCAL = 1
	CASE 103
		LOCAL = 3
	CASE 105
		LOCAL = 1
	CASE 106
		LOCAL = 1
	;レッスン
	CASE 130
		LOCAL = 1
	CASE 140
		LOCAL = 0
	CASE 150
		LOCAL = 0
	CASE 1000 TO 1299
		LOCAL = 3
	CASE 1300 TO 1399
		LOCAL = 2
	CASEELSE
		LOCAL = 0
ENDSELECT
ARG:0 += LOCAL
SELECTCASE ARG:1
	CASE 100
		LOCAL:1 = 0
	CASE 101
		LOCAL:1 = 1
	CASE 102
		LOCAL:1 = 1
	CASE 103
		LOCAL:1 = 3
	CASE 105
		LOCAL:1 = 1
	CASE 106
		LOCAL:1 = 1
	CASE 130
		LOCAL:1 = 1
	CASE 140
		LOCAL:1 = 1
	CASE 150
		LOCAL:1 = 1
	CASE 1000 TO 1299
		LOCAL:1 = 3
	CASE 1300 TO 1399
		LOCAL:1 = 2
	CASEELSE
		LOCAL:1 = 0
ENDSELECT
IF (ARG:0 - LOCAL:1) >= 0
	BASE:0:10 += LOCAL
	BASE:0:10 -= LOCAL:1
	RETURN 1
ELSE
	PRINTFORMW コストが足りません！
	RETURN 0
ENDIF
;GET_WORK_EXPLAIN 仕事の説明を表示

;ARG:0 仕事番号
@WORK_EXPLAIN(ARG:0)
VARSET LOCAL
PRINTL
CUSTOMDRAWLINE =

SELECTCASE ARG:0
	CASE 1000 TO 1099
		CALL オーディションデータ(ARG)
		PRINTFORM オーディション
		PRINTL
	CASE 1100 TO 1199
		PRINTFORM ライブ
		PRINTL
	CASE 1200 TO 1299
		PRINTFORM フェス
		PRINTL
	CASE 1300 TO 1399
		PRINTFORM 営業
		PRINTL
	CASEELSE
ENDSELECT
PRINTFORM %GET_WORK_NAME(ARG:0),24,LEFT%【難易度{GET_WORK_DIFFICULTY(ARG:0)}】
PRINTL
SELECTCASE ARG:0
	CASE 1000 TO 1099
		CALL オーディションデータ(ARG)
		PRINTFORM 合格枠：{TFLAG:合格人数}人
		PRINTL
	CASE 1100 TO 1199
		CALL ライブデータ(ARG)
		IF TFLAG:合格ハコユレ震度 >= 10
			LOCAL = TFLAG:合格ハコユレ震度 % 10
			LOCAL:1 = TFLAG:合格ハコユレ震度 / 10
			PRINTFORML 目標ハコユレ：{LOCAL:1}.{LOCAL}
		ELSE
			PRINTFORML 目標ハコユレ：0.{TFLAG:合格ハコユレ震度}
		ENDIF
	CASEELSE
ENDSELECT
CALL GET_WORK_FAN(ARG:0)
PRINTFORM ファン数：{RESULT}
CALL GET_WORK_GUARANTEE(ARG:0)
PRINTFORM ギャラ：%ADD_COMMA(RESULT)% 
PRINTL
DRAWLINE
PRINTBUTTONLC "[セット]", ARG:0
PRINTBUTTONLC "[キャンセル]", -1
$INPUT_LOOP
INPUT
IF RESULT == -1
	RETURN
ELSEIF RESULT == ARG:0
	CALL SET_WORK(ARG:0)
	IF RESULT
		RETURN
	ELSE
	ENDIF
ELSE
ENDIF
RESTART

