@MAKE_CSV
DRAWLINE
;1番に保存してから削除
PRINTFORMLC [1]名前
PRINTFORMLC [2]基礎
PRINTFORMLC [3]素質
PRINTFORMLC [4]外見
PRINTFORMLC [5]衣装
PRINTFORMLC [6]能力
PRINTFORMLC [7]主導権基準値
PRINTFORMLC [8]経験
;PRINTFORMLC [9]フレーバー
PRINTL 
PRINTFORML [100]出力
PRINTFORML [200]データリセット
PRINTFORML [300]セーブ
PRINTFORML [400]CSV読み込み
PRINTFORML [0]戻る
INPUT
PRINTL 
SELECTCASE RESULT
	CASE 0
		RETURN 
	CASE 1
		CALL MAKE_CHARA_DATA("NAME")
	CASE 2
		CALL MAKE_CHARA_DATA("BASE")
	CASE 3
		CALL MAKE_CHARA_DATA("TALENT")
	CASE 4
		CALL MAKE_CHARA_DATA("LOOKS")
	CASE 5
		CALL MAKE_CHARA_DATA("CLOTH")
	CASE 6
		CALL MAKE_CHARA_DATA("ABL")
	CASE 7
		PRINTFORML 気の強さを入力して下さい
		INPUT
		CFLAG:1:主導権基準値 = RESULT
	CASE 8
		CALL MAKE_CHARA_DATA("EXP")
	CASE 100
		CALL MAKE_CHARA_DATA("OUTPUT")
	CASE 200
		CALL MAKE_CHARA_DATA("RESET")
	CASE 300
		CALL SAVEGAME_EX
ENDSELECT
RESTART

;プレイヤーが使うことを想定してないので、基本的に例外をスローしません
@MAKE_CHARA_DATA(ARGS)
VARSET LOCAL
CALL SET_COLOR(20)
PRINTFORML %CALLNAME:1%
RESETCOLOR
SELECTCASE ARGS
	CASE "OUTPUT"
		CALL OUTPUT_CSV
		RETURN
	CASE "NAME"
		CALL MAKE_CHARA_NAME
		RETURN 
	CASE "LOOKS"
		CALL MAKE_CHARA_LOOKS
		RETURN 
	CASE "CLOTH"
		CALL MAKE_CHARA_CLOTH
		RETURN
	CASE "PERSONAL"
		CALL MAKE_CHARA_PERSONAL
		RETURN
	CASE "RESET"
		PRINTFORML 本当にリセットしますか？
		CALL INPUT_YN,"リセットする","リセットしない"
		IF RESULT == 0
			VARSET CFLAG:1:0, 0
			VARSET ABL:1:0, 0
			VARSET TALENT:1:0, 0
			VARSET BASE:1:0, 0
			VARSET EXP:1:0, 0
			VARSET EQUIP:1:0, 0
			VARSET NAME:1
			VARSET CALLNAME:1
		ENDIF
		RETURN 
	CASEELSE
ENDSELECT
LOCALS = ARGS
DO
	REDRAW 0
	CALL SAVELINE
	FOR LOCAL, 0, 1000
		VARSET LOCALS
		SELECTCASE ARGS
			CASE "BASE"
				VARSIZE BASE
				SIF LOCAL >= RESULT
					CONTINUE
				SIF LOCAL >= 6 && LOCAL <= 10
					CONTINUE
				SIF LOCAL >= 22 && LOCAL <= 28
					CONTINUE
				SIF !STRLENS(BASENAME:LOCAL)
					CONTINUE
				SIF LOCAL >= 40
					CONTINUE
				PRINTFORMLC [{LOCAL, 3, LEFT}]%BASENAME:LOCAL, 16, LEFT% - (現在：{BASE:1:LOCAL, 5, LEFT})
			CASE "TALENT"
				SIF LOCAL >= 150 && LOCAL < 250
					CONTINUE
				SIF LOCAL > 600
					CONTINUE
				SIF !STRLENS(TALENTNAME:LOCAL)
					CONTINUE
				;素質ありか無しで●×が付く
				PRINTFORMLC [{LOCAL, 3, LEFT}]%TALENTNAME:LOCAL, 16, LEFT% \@ TALENT:1:LOCAL > 0 ? ○ # × \@ 
			CASE "ABL"
				VARSIZE ABL
				SIF LOCAL >= RESULT
					CONTINUE
				SIF !STRLENS(ABLNAME:LOCAL)
					CONTINUE
				SIF LOCAL >= 50 || (LOCAL >=31 && LOCAL<40)
					CONTINUE
				PRINTFORMLC [{LOCAL, 3, LEFT}]%ABLNAME:LOCAL, 16, LEFT% - (現在：{ABL:1:LOCAL, 5, LEFT})
			CASE "EXP"
				VARSIZE EXP
				SIF LOCAL >= RESULT
					CONTINUE
				SIF !STRLENS(EXPNAME:LOCAL)
					CONTINUE
				SIF LOCAL > 100
					CONTINUE
				PRINTFORMLC [{LOCAL, 3, LEFT}]%EXPNAME:LOCAL, 16, LEFT% - (現在：{EXP:1:LOCAL, 5, LEFT})
		ENDSELECT
	NEXT
	PRINTL 
	PRINTL [1000]戻る
	INPUT
	IF RESULT == 1000
		BREAK
	ELSEIF RESULT >= 0
		LOCAL:1 = RESULT
		SELECTCASE ARGS
			CASE "BASE"
				;BASE:1:RESULT = !BASE:1:RESULT
				PRINTFORM %BASENAME:RESULT%の値を入力して下さい(現在：{BASE:1:RESULT})
				SELECTCASE RESULT
					CASE 4
						LOCAL:3 = 12
						LOCAL:4 = 37
					CASE 5
						LOCAL:3 = 9
						LOCAL:4 = 28
					CASE 31
						LOCAL:3 = 8
						LOCAL:4 = 15
					CASE 32
						LOCAL:3 = 3
						LOCAL:4 = 6
					CASE 33
						LOCAL:3 = 10
						LOCAL:4 = 17
					CASE 34
						LOCAL:3 = 6
						LOCAL:4 = 14
					CASE 35
						LOCAL:3 = 6
						LOCAL:4 = 11
					CASE 36
						LOCAL:3 = 12
						LOCAL:4 = 20
				ENDSELECT
				PRINTFORM (min{LOCAL:3} - max{LOCAL:4})
				PRINTL 
				INPUT
				BASE:1:(LOCAL:1) = RESULT
			CASE "TALENT"
				TALENT:1:(LOCAL:1) = !TALENT:1:RESULT
			CASE "ABL"
				;ABL:1:RESULT = !ABL:1:RESULT
				PRINTFORML %ABLNAME:RESULT%の値を入力して下さい(現在：{ABL:1:RESULT})
				INPUT
				ABL:1:(LOCAL:1) = RESULT
			CASE "EXP"
				;EXP:1:RESULT = !EXP:1:RESULT
				PRINTFORML %EXPNAME:RESULT%の値を入力して下さい(現在：{EXP:1:RESULT})
				INPUT
				EXP:1:(LOCAL:1) = RESULT
		ENDSELECT
	ELSE
		
	ENDIF
	CALL RETURNLINE
LOOP 1
CALL RETURNLINE
RETURN 0
	
@MAKE_CHARA_NAME
VARSET LOCAL
PRINTFORML [1]名前%"\t"%%NAME:1%
PRINTFORML [2]呼び名%"\t"%%CALLNAME:1%
PRINTFORML [3]略称%"\t"%%CSTR:1:21%
PRINTL 
PRINTL [0]戻る
INPUT
SIF RESULT == 1 || RESULT == 2 || RESULT == 3
	LOCAL = RESULT
SIF RESULT == 0
	RETURN
SIF !LOCAL
	RESTART
INPUTS
SELECTCASE LOCAL
	CASE 1
		NAME:1 = %RESULTS%
	CASE 2
		CALLNAME:1 = %RESULTS%
	CASE 3
		CSTR:1:21 = %RESULTS%
ENDSELECT
RESTART

@MAKE_CHARA_CLOTH
VARSET LOCAL
PRINTFORML 衣装を設定します
FOR LOCAL, 10, 100
	SIF !STRLENS(EQUIPNAME:LOCAL)
		CONTINUE
	PRINTFORM [{LOCAL}] %EQUIPNAME:LOCAL, 16, LEFT%（
	SELECTCASE LOCAL
		CASE 10
			PRINTFORM %COSPLAY(1)%
		CASE 11
			PRINTFORM %GLOVES(1)%
		CASE 12
			PRINTFORM %SOCKS(1)%
		CASE 13
			PRINTFORM %INNER_B(1)%
		CASE 14
			PRINTFORM %INNER_T(1)%
		CASE 15
			PRINTFORM %OUTER_B(1)%
		CASE 16
			PRINTFORM %OUTER_T2(1)%
		CASE 17
			PRINTFORM %OUTER_T(1)%
		CASE 18
			PRINTFORM %DRESS(1)%
		CASE 19
			PRINTFORM %INNER_TB(1)%
		CASE 20
			PRINTFORM %HEAD(1)%
		CASE 22 TO 26
			PRINTFORM %ACCESSORY1(1,,LOCAL)%
	ENDSELECT
	PRINTFORML ）
NEXT
PRINTL 
PRINTFORML [0]戻る
INPUT
LOCAL:1 = RESULT
SELECTCASE RESULT
	CASE 0
		RETURN
	CASE 10 TO 26
		PRINTFORML どれを付けますか？
		FOR LOCAL, 1, 100
			EQUIP:1:(LOCAL:1) = LOCAL
			;SELECTCASE LOCAL:1
					SELECTCASE LOCAL:1
						CASE 10
							SIF !STRLENS(@"%COSPLAY(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%COSPLAY(1)%
						CASE 11
							SIF !STRLENS(@"%GLOVES(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%GLOVES(1)%
						CASE 12
							SIF !STRLENS(@"%SOCKS(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%SOCKS(1)%
						CASE 13
							SIF !STRLENS(@"%INNER_B(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%INNER_B(1)%
						CASE 14
							SIF !STRLENS(@"%INNER_T(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%INNER_T(1)%
						CASE 15
							SIF !STRLENS(@"%OUTER_B(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%OUTER_B(1)%
						CASE 16
							SIF !STRLENS(@"%OUTER_T2(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%OUTER_T2(1)%
						CASE 17
							SIF !STRLENS(@"%OUTER_T(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%OUTER_T(1)%
						CASE 18
							SIF !STRLENS(@"%DRESS(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%DRESS(1)%
						CASE 19
							SIF !STRLENS(@"%INNER_TB(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%INNER_TB(1)%
						CASE 20
							SIF !STRLENS(@"%HEAD(1)%")
								CONTINUE
							PRINTFORML [{LOCAL}]%HEAD(1)%
						CASE 22 TO 26
							;PRINTFORML LOCAL={LOCAL}
							;PRINTFORML LOCAL:1 = {LOCAL:1}
							;PRINTFORML EQUIP:1:(LOCAL:1) = {EQUIP:1:(LOCAL:1)}
							;PRINTFORMW アクセサリー名%ACCESSORY1(1,,LOCAL:1)%
							SIF !STRLENS(@"%ACCESSORY1(1,,(LOCAL:1-20))%")
								CONTINUE
							PRINTFORML [{LOCAL}]%ACCESSORY1(1,,(LOCAL:1-20))%
					ENDSELECT
			;ENDSELECT
		NEXT
		PRINTFORML [0]戻る
		INPUT
		EQUIP:1:(LOCAL:1) = RESULT
ENDSELECT
RESTART
@MAKE_CHARA_PERSONAL
@OUTPUT_CSV
PRINTFORML 名前, %NAME:1%
PRINTFORML 呼び名, %CALLNAME:1%
PRINTFORML CSTR,21, %CSTR:1:21%
PRINTL 
FOR LOCAL, 0, 200
	VARSIZE BASE
	SIF LOCAL >= RESULT
		BREAK
	SIF BASE:1:LOCAL > 0
		PRINTFORML 基礎, %BASENAME:LOCAL%,{BASE:1:LOCAL}
NEXT
PRINTL 
FOR LOCAL, 0, 600
	VARSIZE TALENT
	SIF LOCAL >= RESULT
		BREAK
	SIF TALENT:1:LOCAL > 0
		PRINTFORML 素質, %TALENTNAME:LOCAL%
NEXT
PRINTL 
FOR LOCAL, 0, 200
	VARSIZE ABL
	SIF LOCAL >= RESULT
		BREAK
	SIF ABL:1:LOCAL > 0
		PRINTFORML 能力, %ABLNAME:LOCAL%,{ABL:1:LOCAL}
NEXT
PRINTL 
FOR LOCAL, 0, 200
	VARSIZE EXP
	SIF LOCAL >= RESULT
		BREAK
	SIF EXP:1:LOCAL > 0
		PRINTFORML 経験, %EXPNAME:LOCAL%, {EXP:1:LOCAL}
NEXT
PRINTL 
FOR LOCAL, 0, 200
	VARSIZE EQUIP
	SIF LOCAL >= RESULT
		BREAK
	SIF EQUIP:1:LOCAL > 0
		PRINTFORML EQUIP, %EQUIPNAME:LOCAL%, {EQUIP:1:LOCAL}
NEXT
PRINTL 
PRINTFORML フラグ, 主導権基準値, {CFLAG:1:主導権基準値}
PRINTL 
FOR LOCAL, 121, 138
	VARSIZE CFLAG
	SIF LOCAL >= RESULT
		BREAK
	SIF CFLAG:1:LOCAL > 0
		PRINTFORML フラグ, %CFLAGNAME:LOCAL%, {CFLAG:1:LOCAL}
NEXT
